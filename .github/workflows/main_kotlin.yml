name: Kotlin Jupyter Notebook

on:
  push:
    branches: [ python_ ]
  workflow_dispatch:

jobs:
  run_notebook:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Jupyter + Kotlin kernel
        run: |
          pip install --upgrade jupyter nbconvert kotlin-jupyter-kernel
          sudo apt-get update -qq
          sudo apt-get install -y openjdk-21-jdk maven
          jupyter kernelspec list

      - name: IKotlin inline (limited usage)
        run: | 
          jupyter-console --kernel=kotlin <<EOF
          println("Hello from IKotlin inline!"); println("Java version: " + System.getProperty("java.version")); println("Java vendor: " + System.getProperty("java.vendor")); println("Java home: " + System.getProperty("java.home"));
          EOF

      - name: Execute Kotlin notebook
        run: |
          NOTEBOOK=notebook.ipynb          # Your input notebook
          EXECUTED_NOTEBOOK=executed.ipynb
          HTML_OUTPUT=executed.html
          LOG_FILE=ikotlin_output.log

          # Execute the notebook with the Kotlin kernel
          jupyter nbconvert --to notebook --execute "$NOTEBOOK" \
            --ExecutePreprocessor.kernel_name=kotlin \
            --ExecutePreprocessor.timeout=600 \
            --output "$EXECUTED_NOTEBOOK" \
            2>&1 | tee "$LOG_FILE"

          # Convert executed notebook to HTML
          jupyter nbconvert --to html "$EXECUTED_NOTEBOOK" --output "$HTML_OUTPUT"

      - name: List generated files
        run: ls -la

      - name: Upload notebook + HTML + log
        uses: actions/upload-artifact@v4
        with:
          name: kotlin-notebook-output
          path: |
            executed.ipynb
            executed.html
            ikotlin_output.log
            chart_kotlin.png
            chart_kotlin_inline.png
